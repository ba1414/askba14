# Timetable Parser Flow Diagram

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PDF/TEXT INPUT                         â”‚
â”‚   "HKU SPACE Master Timetable - Semester 1 2024-25"        â”‚
â”‚   "CCAH3003 CL01 The Process of Design 1 2 08:30..."       â”‚
â”‚   "Last updated: 15 Dec 2024"                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              1. SPLIT INTO LINES                            â”‚
â”‚   lines = content.split('\n').filter(l => l.trim())        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              2. FILTER NON-ROW LINES                        â”‚
â”‚   isNonRowLine(line) â†’ DISCARD if:                         â”‚
â”‚   â€¢ Contains "HKU SPACE"                                    â”‚
â”‚   â€¢ Contains "Last updated"                                 â”‚
â”‚   â€¢ Contains "Page X"                                       â”‚
â”‚   â€¢ Column headers                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           3. DETECT CANDIDATE LINES                         â”‚
â”‚   isCandidateLine(line) â†’ KEEP if:                         â”‚
â”‚   â€¢ Has time range: /\d{1,2}:\d{2}\s*-\s*\d{1,2}:\d{2}/   â”‚
â”‚   â€¢ Starts with course code: /^[A-Z]{3,6}\d{4}/            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        4. PARSE EACH CANDIDATE (Right-Anchored)             â”‚
â”‚                                                             â”‚
â”‚   Input: "CCAH3003 CL01 The Process of Design 1 2 08:30..." â”‚
â”‚                                                             â”‚
â”‚   Step 1: Find time anchor                                 â”‚
â”‚   â”œâ”€ timeMatch = "08:30 - 09:50"                          â”‚
â”‚   â””â”€ timeStartIdx = 44                                     â”‚
â”‚                                                             â”‚
â”‚   Step 2: Extract room (after time)                       â”‚
â”‚   â”œâ”€ afterTime = "FTC1902"                                â”‚
â”‚   â””â”€ room = "FTC1902"                                     â”‚
â”‚                                                             â”‚
â”‚   Step 3: Split before time                               â”‚
â”‚   â”œâ”€ beforeTime = "CCAH3003 CL01 The Process of Design 1 2"â”‚
â”‚   â””â”€ tokens = ["CCAH3003", "CL01", "The", "Process",     â”‚
â”‚                 "of", "Design", "1", "2"]                  â”‚
â”‚                                                             â”‚
â”‚   Step 4: Extract from right                              â”‚
â”‚   â”œâ”€ weekday = tokens[7] = "2" â†’ "Tue"                   â”‚
â”‚   â””â”€ semester = tokens[6] = "1"                           â”‚
â”‚                                                             â”‚
â”‚   Step 5: Extract from left                               â”‚
â”‚   â”œâ”€ courseCode = tokens[0] = "CCAH3003"                 â”‚
â”‚   â””â”€ classNo = tokens[1] = "CL01"                        â”‚
â”‚                                                             â”‚
â”‚   Step 6: Middle = course name                            â”‚
â”‚   â””â”€ courseName = tokens[2..5].join(' ')                 â”‚
â”‚                    = "The Process of Design"               â”‚
â”‚                                                             â”‚
â”‚   Output: {                                                â”‚
â”‚     courseCode: "CCAH3003",                               â”‚
â”‚     section: "CL01",                                      â”‚
â”‚     courseName: "The Process of Design",                  â”‚
â”‚     day: "Tue",                                           â”‚
â”‚     startTime: "08:30",                                   â”‚
â”‚     endTime: "09:50",                                     â”‚
â”‚     location: "FTC1902"                                   â”‚
â”‚   }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              5. VALIDATE & NORMALIZE                        â”‚
â”‚   validateRow(parsed) â†’ Check:                            â”‚
â”‚   â€¢ courseCode not empty                                   â”‚
â”‚   â€¢ day is valid weekday                                   â”‚
â”‚   â€¢ times are valid HH:MM                                  â”‚
â”‚   â†’ Set isValid = true/false                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              6. COUNT UNIQUE COURSES                        â”‚
â”‚   uniqueCourses = new Set(rows.map(r => r.courseCode))    â”‚
â”‚   uniqueOptions = new Set(rows.map(r => `${code}:${sec}`))â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OUTPUT RESULT                            â”‚
â”‚   {                                                         â”‚
â”‚     success: true,                                         â”‚
â”‚     rows: [...],                                           â”‚
â”‚     warnings: [],                                          â”‚
â”‚     uniqueCourses: 4,                                      â”‚
â”‚     uniqueOptions: 10                                      â”‚
â”‚   }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Example Line Processing

```
INPUT LINE:
"CCAH3003 CL01 The Process of Design 1 2 08:30 - 09:50 FTC1902"

STEP-BY-STEP PARSING:

1. Check filters:
   âœ… Not "HKU SPACE"
   âœ… Not header/footer
   âœ… Has time range
   âœ… Starts with course code

2. Extract time:
   Match: "08:30 - 09:50"
   startTime = "08:30"
   endTime = "09:50"
   Position: index 44

3. Split at time:
   Before: "CCAH3003 CL01 The Process of Design 1 2"
   After:  "FTC1902"

4. Tokenize before-time:
   [0]="CCAH3003"  â† courseCode
   [1]="CL01"      â† section
   [2]="The"       â”
   [3]="Process"   â”œâ”€ courseName
   [4]="of"        â”‚
   [5]="Design"    â”˜
   [6]="1"         â† semester
   [7]="2"         â† weekday (Tue)

5. Extract room from after-time:
   "FTC1902" â† location

6. Map weekday:
   "2" â†’ NUMERIC_WEEKDAY_MAP["2"] â†’ 1 â†’ "Tue"

OUTPUT:
{
  courseCode: "CCAH3003",
  section: "CL01",
  courseName: "The Process of Design",
  day: "Tue",
  startTime: "08:30",
  endTime: "09:50",
  location: "FTC1902",
  isValid: true
}
```

## Filter Decision Tree

```
                    LINE INPUT
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Is it empty/short?   â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                YESâ”‚         â”‚NO
                   â–¼         â”‚
              [DISCARD]      â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Contains "HKU SPACE"?  â”‚
            â”‚ Contains "Last updated"?â”‚
            â”‚ Contains "Page"?       â”‚
            â”‚ Is column header?      â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                YESâ”‚         â”‚NO
                   â–¼         â”‚
              [DISCARD]      â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Has time range?        â”‚
            â”‚ /\d:\d{2}\s*-\s*\d:\d{2}/â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  NOâ”‚        â”‚YES
                   â–¼         â”‚
              [DISCARD]      â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Starts with course code?â”‚
            â”‚ /^[A-Z]{3,6}\d{4}/     â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  NOâ”‚        â”‚YES
                   â–¼         â”‚
              [DISCARD]      â”‚
                             â–¼
                      [PARSE AS ROW]
```

## Safety Net Flow

```
                    PARSE ATTEMPT
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
   SUCCESS         PARTIAL OK         FAILURE
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
   isValid=true    status='needs-fixing'  errors=[...]
   errors=[]       errors=[warnings]      isValid=false
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              ALL RETURNED TO UI
           (None silently dropped)
```

## Weekday Mapping

```
INPUT      â†’  MAP     â†’  OUTPUT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "1"      â†’  0       â†’  "Mon"
  "2"      â†’  1       â†’  "Tue"
  "3"      â†’  2       â†’  "Wed"
  "4"      â†’  3       â†’  "Thu"
  "5"      â†’  4       â†’  "Fri"
  "6"      â†’  5       â†’  "Sat"
  "7"      â†’  6       â†’  "Sun"
  "Mon"    â†’  (pass)  â†’  "Mon"
  "Tue"    â†’  (pass)  â†’  "Tue"
  ...
```

## Debug Output Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CONSOLE OUTPUT               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Parse Debug: {                       â”‚
â”‚   extractedChars: 5432               â”‚
â”‚   totalLines: 45                     â”‚
â”‚   candidateLines: 12    â† Key metricâ”‚
â”‚   parsedRows: 10                     â”‚
â”‚   needsFixingRows: 2                 â”‚
â”‚   filteredLines: 33     â† Headers   â”‚
â”‚ }                                    â”‚
â”‚ Courses detected: 4                  â”‚
â”‚ Options detected: 10                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          UI DEBUG PANEL              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Debug Info                        â”‚
â”‚ â”œâ”€ Total rows: 10                    â”‚
â”‚ â”œâ”€ Valid: 10 | Invalid: 0            â”‚
â”‚ â”œâ”€ Unique courses: 4                 â”‚
â”‚ â”œâ”€ Class options: 10                 â”‚
â”‚ â””â”€ Sample courses:                   â”‚
â”‚    â€¢ CCAH3003 - The Process of Designâ”‚
â”‚    â€¢ CHIN9001 - Modern Chinese...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Time Parsing Examples

```
INPUT                â†’  EXTRACTED       â†’  NORMALIZED
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"08:30 - 09:50"     â†’  "08:30","09:50"  â†’  "08:30","09:50"
"8:30-9:50"         â†’  "8:30","9:50"    â†’  "08:30","09:50"
"8.30â€“9.50"         â†’  "8.30","9.50"    â†’  "08:30","09:50"
"08:30-09:50"       â†’  "08:30","09:50"  â†’  "08:30","09:50"
"18:00 - 21:00"     â†’  "18:00","21:00"  â†’  "18:00","21:00"
```

## Room Pattern Examples

```
INPUT           â†’  PATTERN         â†’  EXTRACTED
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"FTC1902"       â†’  Alphanumeric    â†’  "FTC1902"
"CIT-1006"      â†’  With hyphen     â†’  "CIT-1006"
"KEE105+106"    â†’  With plus       â†’  "KEE105+106"
"SCI-LAB3"      â†’  Mixed           â†’  "SCI-LAB3"
"LG101"         â†’  Short form      â†’  "LG101"
```
